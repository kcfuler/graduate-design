# 深度学习交通标志识别系统 - 解决方案设计

## 前端实现方案

### 技术选择
- **React + TypeScript**: 提供类型安全和更好的开发体验
- **Vite**: 轻量级构建工具，支持快速开发
- **Shadcn UI**: 基于Tailwind CSS的美观UI组件库
- **Axios**: 用于API请求处理

### 关键组件设计

#### 模型选择界面
提供两种实现方案：
1. **下拉选择器**: 使用Shadcn的Select组件，简单直观
   - 优点: 实现简单，UI清晰
   - 缺点: 无法展示模型详细信息
   
2. **卡片选择器**: 使用Card组件展示每个模型的详细信息
   - 优点: 可以展示模型说明和性能指标
   - 缺点: 占用更多屏幕空间

**选择**: 结合两者 - 主界面使用下拉选择器，但提供"详情"链接打开展示模型详情的模态框。

#### 图像/视频上传处理
提供多种媒体输入方式：
1. **本地文件上传**: 使用`<input type="file">`结合拖放功能
2. **URL输入**: 支持直接输入图片/视频URL
3. **摄像头捕获**: 可选功能，使用WebRTC

图像预览和处理方案：
- 使用Canvas绘制边界框和标签
- 视频处理采用帧采样方式，降低服务器压力

#### 结果展示
1. 图像结果: 在原图上叠加边界框，显示标签和置信度
2. 视频结果: 两种方案
   - **实时处理**: 逐帧发送请求，显示实时结果
   - **离线处理**: 上传视频后后台处理，完成后展示结果

**选择**: 先实现离线处理，作为可选功能添加实时处理能力。

## 中间件实现方案

### 技术选择
- **Express.js + TypeScript**: 轻量级Node.js框架，使用TypeScript提供类型安全
- **http-proxy-middleware**: 提供请求代理功能

### 设计方案
1. **统一API入口**: 所有前端请求通过`/api/*`路由
2. **请求转发**: 将请求无缝转发到Python后端
3. **错误处理**: 拦截并转换后端错误，提供一致的错误响应

### 数据流优化
考虑以下两种方案处理大文件上传：
1. **直接代理**: 通过中间件直接转发上传请求
   - 优点: 实现简单
   - 缺点: 可能导致内存问题
   
2. **流式处理**: 使用流式处理大文件
   - 优点: 内存效率高
   - 缺点: 实现复杂度增加

**选择**: 对于普通图片使用直接代理，对于视频文件考虑实现流式处理。

## 后端实现方案

### 技术选择
- **FastAPI**: 高性能Python API框架，支持异步
- **OpenCV**: 用于图像处理
- **Pydantic**: 数据验证和序列化
- **模型占位符**: 预留TensorFlow/PyTorch/ONNX的接口

### 模型管理设计
两种方案：
1. **配置文件驱动**: 使用JSON/YAML配置文件
   - 优点: 简单直观
   - 缺点: 不够灵活
   
2. **数据库驱动**: 使用轻量级数据库
   - 优点: 更灵活，支持动态注册模型
   - 缺点: 增加复杂度

**选择**: 先实现配置文件驱动方案，后续可扩展为数据库驱动。

### 推理流程设计
提供模块化的推理流程：
1. **图像预处理**: 调整大小、归一化等
2. **模型推理**: 根据模型类型调用不同实现
   - MobileNet: 图像分类，全局识别
   - YOLO: 对象检测，定位+分类
3. **结果后处理**: 非极大值抑制、阈值过滤等

### 并发处理
两种推理处理方案：
1. **同步处理**: 直接在请求处理流程中执行推理
   - 优点: 实现简单
   - 缺点: 长时间推理会阻塞请求
   
2. **异步处理**: 使用异步任务队列
   - 优点: 更好的响应性能
   - 缺点: 实现复杂

**选择**: 先实现简单的同步处理，保留接口用于后续添加异步处理能力。

## 系统集成与部署

### 开发环境
- 前端: `http://localhost:5173`
- 中间件: `http://localhost:3001`
- 后端: `http://localhost:8000`

### 跨域处理
使用中间件代理解决跨域问题，避免前端直接跨域请求后端。

### 部署考虑
1. **开发部署**: 分别启动三个服务
2. **生产部署**: 两种方案
   - Docker Compose: 三个容器协同工作
   - 单体部署: 中间件托管前端静态文件，同时代理后端请求 